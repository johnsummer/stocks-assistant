# CLIツールの使い方

## 起動

- 特定の銘柄コードだけトレードしたい場合、以下のコマンドで起動する（単独モード）
  ```
  python TradingTraining-CLI.py [銘柄コード]
  ```
- 途中銘柄の切り替えができるようなトレードをしたい場合、以下のコマンドで起動する（銘柄可変モード）
  ```
  python TradingTraining-CLI.py ca
  ```
  または
  ```
  python TradingTraining-CLI.py changeable
  ```
- その他のパラメータについては以下のコマンドで確認できる
  ```
  python TradingTraining-CLI.py -h
  ```

## 起動後の操作コマンド

### 指令・操作系コマンド

- `yyyymmdd <空売りロット数>-<買いロット数> [<大引注文の株価>:<翌日寄付注文の株価>]`：取引する。
  - それぞれ持っているロット数と同じ数で入力した場合、実際取引が発生しない。その場合、該当日付の株価と比較し、`平均売り単価`・`平均取得単価`の背景色により損か益かの確認ができる。
  - `<大引注文の株価>:<翌日寄付注文の株価>`の指定有無について
    - 指定しない場合はアプリケーションが持っている株データ（デフォルトではインターネットから取得したもの）で注文する。
    - 指定した場合は指定値でアプリケーションが持っている株データを上書きする（大体データ誤りの場合のみ指定する必要があるため。今後は上書き要否を制御するオプションを追加する予定）
  - `<大引注文の株価>`と`<翌日寄付注文の株価>`の入力による挙動：
    - どちらかは正数以外の文字列を入力した場合、または入力しない場合は指定しないとされ、取得された株データにある株価で注文される。
    - 例えば、`3000:xxx`, `3000:-200`, `3000:`のいずれも翌日寄付注文は取得された株データの株価で注文される。
- `memo yyyymmdd <メモ内容>`:指定した日付に対してメモを記録する。
  - 大引けの日付を基準でメモを記録する。寄付の場合は指定した日付の次の営業日に対してメモを記録する。
- `history show [close/open/opcl]`：戻す可能な取引一覧を表示する。
  - `close/open/opcl`の指定を省力した場合、大引け売買(`close`)の取引のみ表示する。
- `history reset <番号>`：指定した番号(何件前)の取引の状態に戻す。番号は`history show`で確認可能。現状は最大30件前の取引の状態に戻す可能。
  - あくまでも誤入力を修正するための再トレードのための機能。意図的にミスを取り消すことを防ぐため、戻す可能な件数を制限している。
- `exit`：アプリを終了する。

### トレード時のパラメータを設定するコマンド

- `y=xxxx`：取引の年を設定する。これ以降は取引、またはメモする際は`yyyy`の指定が省略可能になり、`mmdd`の部分だけ入力すればよい。
- `l=<整数>`：ロットサイズを変更する。
  - ポジションが`0-0`でない場合はロットサイズの変更ができない。
  - `history reset`コマンドで取引の状態を戻した場合、戻す先の取引当時のロットサイズに設定される。
- `i=<銘柄コード>`：銘柄可変モードの場合、トレード対象の銘柄コードを指定し、トレード対象の銘柄を切り替える。
  - ポジションが`0-0`でない場合は銘柄の切り替えができない。
- `lr yyyymmdd <想定総玉数>`：ロットサイズを既定のアルゴリズムで自動計算する。
  - ポジションが`0-0`でない場合はロットサイズの再計算ができない。
  - アルゴリズムについては後述
  - 想定総玉数の指定を省く場合はデフォルトで20となる。
- `summary [close/open/opcl] [output] [all]`：現在実施中のトレードのサマリーを表示・ファイルに出力する。
  - コマンドプロンプトではデフォルトで直近の10件まで表示する。
  - ファイルへの出力はいつも全件出力する。
  - `close/open/opcl`を省略した場合は`close`として実行する。
  - `output`を付けると表示されたサマリーをcsvファイルに出力する。付けない場合はコマンドプロンプトで表示するだけ。
  - `all`を付けるとコマンドプロンプトに全件表示する。
  - `output`と`all`のいずれを付ける場合は`close/open/opcl`の省略はできない。
- `allow_over_assets=<true/false>`：空売り、または買い注文の総額が総資産を超過しているかを常にチェックされているが、超過している場合の処理モードを設定する。
  - `true`: 警告を出す。
  - `false`: 超過のほう(空売り、または買い)の新規注文はできない　(デフォルト)。
  - ※空売りと買いの注文総額が信用取引の限度(総資産の3.3倍)を超えた場合、処理モードの設定に問わず、注文総額がその限度を下回るまでは新規注文ができない。

### `-ro`を付けて起動した後のコマンド

- `<レードの番号>`：指定した番号のトレードの状態でトレードを再開する
- `summary <レードの番号> [close/open/opcl] [output]`：指定した番号のトレードの状態でトレードのサマリーを表示・ファイルに出力する。
  - コマンドプロンプトでの表示とファイルへの出力はいつも全件になる。
  - `close/open/opcl`を省略した場合は`close`として出力する
  - `output`を付けると表示されたサマリーをcsvファイルに出力する。付けない場合はコマンドプロンプトで表示するだけ。
  - `output`を付ける場合は`close/open/opcl`の省略はできない。

## その他

### 背景色について

- 赤：利益になっている
- 緑：損になっている

### ロットサイズ自動計算のアルゴリズム

- 基本的な計算式：玉サイズ = トレードで注文できる最大金額 ÷ ( 想定総玉数 × 株価 × 1.1 )
  - 想定総玉数について
    - あくまでも計算時の想定値となる。実際トレードを進めると、当時の株価によって投入できる玉数は増減することがある
    - 株価が上昇すると投入できる玉数は想定より少なくなり、想定していた資金管理計画が破綻する可能性がある。その影響を抑制するために、株価を1.1でかけたものを計算時に使うようにした
- トレードで注文できる総金額 = トレードで導入する資金 × 3.3（信用取引を利用する前提）
  - 複数の注文方式（終値、翌日寄付、など）で同時にトレードしている場合、その中で一番小さい総資金を導入資金とする
- 玉サイズは100の桁まで切り捨てる。
  - 最初の計算結果は100未満の場合は100に切り上げる
